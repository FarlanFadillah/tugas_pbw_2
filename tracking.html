<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/tracking.css" />
  <link rel="stylesheet" href="./css/navbar.css">
  <link rel="stylesheet" href="./css/my_style.css">
  <link rel="stylesheet" href="./css/modal.css">
  <title>Tracking</title>
</head>
<body>
  <div id="app">
    <div class="container">
      <div class="search-box">
        <label for="nomor_do">No. DO/Billing</label>
        <div class="input-group flex-row">
          <input class="flex-strech" v-model="nomor_do" list="order_list" id="nomor_do" placeholder="Masukkan nomor DO/Billing" />
          
          <datalist id="order_list">
            <option v-for="value of Object.keys(tracking)" :value="value">{{value}}</option>
          </datalist>
          
          <button @click="searchDoNumber" class="btn btn-yellow no-margin">Lacak</button>
          <button @click="generateDO" onClick="openFormModal()" class="btn btn-blue no-margin">New</button>
        </div>
      </div>
      
      <span class="loading-container">
        <p ref="loading_circle" class="loading-circle"></p>
      </span>     
      <span ref="message_text" class="message">
        <p>{{message}}</p>
      </span>   
      
      <div ref="info_card" class="info-card">
        <div class="info-row">
          <div class="info-mahasiswa">
            <h3>{{current_order?.nama}}</h3>
            <h4>{{current_order?.nim}}</h4>
          </div>
          <div class="info-date">
            <p>Tangal Kirim : {{current_order?.tanggalKirim}}</p>
          </div>
        </div>
        <p class="status">
          {{current_order?.status}}
        </p>
        <p class="ekspedisi">
          {{current_order?.paket}} {{current_order?.expedisi}}
        </p>
      </div>

      <div ref="tracking_card" class="tracking_card">
        <h3>Perjalanan Paket</h3>
        <ul class="timeline">
          <!-- Timeline perjalanan paket -->
          <li v-for="value of current_order?.perjalanan">
              <div class="dot"></div>
              <div class="content">
                  <p>{{value.keterangan}}</p>
                  <span>{{new Date(value.waktu).toLocaleString()}}</span>
              </div>
          </li>
        </ul>
      </div>
    </div>

    <div class="container form-modal">
        <div class="modal fit-content">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Delivery Form</h3>
                </div>
                <div class="modal-body">
                    <form id="book-form" class="grid" v-on:submit.prevent="submitForm" v-model="form">
                        <div class="input-group">
                            <label for="kode">Number Delivery Order</label>
                            <input readonly class="readonly" required v-model="generatedDO" type="text" name="kode">
                        </div>

                        <div class="input-group">
                            <label for="nim">NIM</label>
                            <input required v-model="form.nim" type="text" name="nim">
                        </div>

                        <div class="input-group">
                            <label for="nama">Nama</label>
                            <input required v-model="form.nama" type="text" name="nama">
                        </div>
                        
                        <div class="input-group">
                            <label for="expedisi">Expedisi</label>
                            <input required v-model="form.expedisi" list="expedisi-list" name="expedisi">

                            <datalist id="expedisi-list">
                                <option v-for="value in pengirimanList" :value="value.kode">{{value.nama}}</option>
                            </datalist>
                        </div>

                        <div class="input-group">
                            <label for="paket-ba">Paket BA</label>
                            <div class="flex-column">
                              <select name="paket-ba" v-model="form.paket">
                                <option v-for="value in paket" :value="value">{{value.nama}} Rp. {{value.harga}}</option>
                              </select>
                              <div v-if="form?.paket" class="list list-ba">
                                <h4>List BA</h4>
                                <ul>
                                  <li v-for="value in form.paket.isi">{{value}}</li>
                                </ul>
                              </div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="tgl-kirim">Tanggal Kirim</label>
                            <input required v-model="form.tanggalKirim" type="date" name="tgl-kirim">
                        </div>

                        <div class="input-group">
                          <label for="harga">Total Harga</label>
                          <input type="text" readonly class="readonly" :value="String('Rp.') + (form.paket?.harga.toLocaleString() || '')">
                        </div>

                    </form>
                    <div v-if="show_message" :class="form_message.type" v-text="form_message.text">{{form_message}}</div>
                </div>
                <div class="modal-footer">
                  <button @click="resetForm" class="btn btn-yellow">Reset</button>
                  <button class="btn btn-gray close-modal-btn">close</button>
                  <input type="submit" form="book-form" class="btn btn-green add-modal-btn" value="Order">
                </div>
            </div>
        </div>
    </div>
  </div>
  
  <script src="/js/vue.min.js"></script>
  <script src="./js/navbar.js"></script>
  <script src="./js/tracking-app.js"></script>
  <script src="./js/delivery-form-modal.js"></script>
</body>
</html>
